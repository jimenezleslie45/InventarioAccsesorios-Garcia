<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Accesorios Garc칤a | Gesti칩n Total Pro</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    /* Estilo General */
    body { background: linear-gradient(135deg, #e0f7fa 0%, #ffffff 50%, #f0f9ff 100%); min-height: 100vh; font-family: 'Poppins', sans-serif; color: #1e293b; }
    
    .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(0, 242, 255, 0.3); border-radius: 20px; box-shadow: 0 8px 32px rgba(0, 180, 216, 0.1); }
    .tab-active { color: #0ea5e9; border-bottom: 3px solid #0ea5e9; font-weight: 700; }
    .btn-action { background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%); color: white; border-radius: 12px; transition: all 0.2s; box-shadow: 0 4px 15px rgba(58, 123, 213, 0.3); }
    .btn-action:active { transform: scale(0.95); }

    /* LOGIN FONDO NEGRO (Neon Style) */
    #loginScreen { 
        background-color: #000000; 
        position: fixed; 
        inset: 0; 
        z-index: 9999; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
    }
    .neon-card { 
        background: #0a0a0a; 
        border: 2px solid #00f2ff; 
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.5); 
        padding: 40px; 
        border-radius: 20px; 
        width: 320px; 
        text-align: center;
    }
    .neon-input { 
        background: transparent; 
        border: 1px solid #00f2ff; 
        color: white; 
        padding: 12px; 
        border-radius: 10px; 
        outline: none; 
        width: 100%;
        margin-bottom: 15px;
    }
    .neon-input:focus { box-shadow: 0 0 10px #00f2ff; }

    #reader { border: 2px solid #00f2ff !important; border-radius: 15px; overflow: hidden; background: white; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #0ea5e9; border-radius: 10px; }
  </style>
</head>
<body class="p-2 md:p-6">

<div id="loginScreen">
  <div class="neon-card">
    <img src="imagen/Logo.jpg" class="w-24 h-24 mx-auto rounded-full mb-6 border-2 border-[#00f2ff] shadow-[0_0_15px_#00f2ff]" alt="Logo Garc칤a">
    <h2 class="text-[#00f2ff] font-bold mb-6 tracking-widest text-xl uppercase">Acceso Garc칤a</h2>
    <div class="space-y-4 text-left">
      <input type="text" id="userInput" placeholder="Usuario" class="neon-input uppercase text-sm">
      <input type="password" id="passInput" placeholder="Contrase침a" class="neon-input text-sm">
      <button onclick="intentarLogin()" class="btn-action w-full py-3 mt-4 font-bold uppercase tracking-widest text-xs shadow-[0_0_10px_#00d2ff]">ENTRAR</button>
    </div>
    <p id="loginError" class="text-red-500 text-[10px] mt-4 hidden font-bold italic">丘멆잺 DATOS INCORRECTOS</p>
  </div>
</div>

<div id="app" class="hidden max-w-7xl mx-auto">
  <header class="text-center mb-6">
    <img src="imagen/Logo.jpg" alt="Logo" class="w-20 h-20 mx-auto rounded-full shadow-lg mb-2 border-2 border-white">
    <h1 class="text-2xl font-bold text-slate-800 uppercase tracking-tight">Accesorios Garc칤a</h1>
    <p id="roleTag" class="text-[10px] font-bold text-cyan-600 uppercase tracking-widest"></p>
  </header>

  <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
    <div class="glass-card p-4 border-l-4 border-sky-400">
      <p class="text-[9px] font-bold text-slate-400 uppercase">Caja Ventas</p>
      <p id="resVentas" class="text-lg font-bold text-slate-700">$0.00</p>
    </div>
    <div class="glass-card p-4 border-l-4 border-amber-500">
      <p class="text-[9px] font-bold text-amber-600 uppercase italic">Utilidad Rifa</p>
      <p id="resRifas" class="text-lg font-bold text-amber-700">$0.00</p>
    </div>
    <div class="glass-card p-4 border-l-4 border-purple-400">
      <p class="text-[9px] font-bold text-slate-400 uppercase">Pendiente Pedidos</p>
      <p id="resPedidos" class="text-lg font-bold text-slate-700">$0.00</p>
    </div>
    <div class="glass-card p-4 bg-emerald-600 text-white">
      <p class="text-[9px] font-bold uppercase opacity-80">Ganancia Neta</p>
      <p id="resNeto" class="text-xl font-bold">$0.00</p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    
    <div class="lg:col-span-5 space-y-6">
      <div class="glass-card p-4">
        <h3 class="text-xs font-bold text-cyan-600 uppercase mb-4 italic"><i class="fas fa-barcode mr-2"></i>Lector de Barras</h3>
        <div id="reader"></div>
        <div id="scanResult" class="mt-4 p-3 bg-cyan-50 rounded-xl border border-cyan-200 text-xs hidden">
          <p class="text-cyan-700 font-bold italic">C칍DIGO: <span id="codeVal" class="text-slate-800 font-mono"></span></p>
        </div>
      </div>

      <div class="glass-card p-6 flex flex-col items-center">
        <h3 class="text-xs font-bold text-slate-500 uppercase mb-4">Balance de Utilidades</h3>
        <canvas id="chartGarcia" style="max-height: 200px;"></canvas>
      </div>
    </div>

    <div class="lg:col-span-7 space-y-6">
      <div class="glass-card p-6">
        <div class="flex gap-4 mb-6 border-b border-slate-100">
          <button onclick="setTab(1)" id="tab1" class="tab-active pb-2 text-xs uppercase font-bold">Ventas/Stock</button>
          <button onclick="setTab(2)" id="tab2" class="text-slate-400 pb-2 text-xs uppercase font-bold">Rifas</button>
          <button onclick="setTab(3)" id="tab3" class="text-slate-400 pb-2 text-xs uppercase font-bold">Pedidos</button>
        </div>

        <form id="formP" class="space-y-4">
          <input type="text" id="pSku" placeholder="C칩digo (Escanear o escribir)" class="w-full p-3 rounded-xl bg-slate-50 ring-1 ring-slate-200 text-sm outline-none">
          <div class="flex gap-2">
            <select id="pTipo" class="w-1/3 p-3 rounded-xl bg-slate-50 ring-1 ring-slate-200 text-sm font-bold text-cyan-600">
              <option value="salida">Venta 游닋</option>
              <option value="entrada">Stock 游닌</option>
            </select>
            <input type="text" id="pNom" placeholder="Nombre Producto" class="w-2/3 p-3 rounded-xl ring-1 ring-slate-200 text-sm outline-none">
          </div>
          <div class="grid grid-cols-2 gap-2">
            <input type="number" id="pCos" placeholder="Costo $" class="p-3 rounded-xl ring-1 ring-slate-200 text-sm">
            <input type="number" id="pPre" placeholder="Venta $" class="p-3 rounded-xl ring-1 ring-slate-200 text-sm">
          </div>
          <button type="submit" class="w-full btn-action font-bold py-3 uppercase text-xs">Registrar Movimiento</button>
        </form>

        <div id="formR" class="hidden space-y-4">
            <input type="text" id="rNom" placeholder="Nombre de la Rifa" class="w-full p-3 rounded-xl ring-1 ring-amber-300 text-sm outline-none">
            <div class="grid grid-cols-2 gap-2">
              <input type="number" id="rCosto" placeholder="Costo Premio $" class="p-3 rounded-xl ring-1 ring-amber-300 text-sm">
              <input type="number" id="rCant" placeholder="N칰ms Vendidos" class="p-3 rounded-xl ring-1 ring-amber-300 text-sm">
            </div>
            <button onclick="guardarRifa()" class="w-full py-3 rounded-xl bg-amber-600 text-white font-bold uppercase text-xs">Guardar Rifa</button>
        </div>

        <div id="formPe" class="hidden space-y-4">
          <input type="text" id="peCli" placeholder="Nombre Cliente" class="w-full p-3 rounded-xl ring-1 ring-purple-300 text-sm outline-none">
          <input type="text" id="pePro" placeholder="Producto" class="w-full p-3 rounded-xl ring-1 ring-purple-300 text-sm outline-none">
          <div class="grid grid-cols-2 gap-2">
            <input type="number" id="peTot" placeholder="Total $" class="p-3 rounded-xl ring-1 ring-purple-300 text-sm">
            <input type="number" id="peAnt" placeholder="Anticipo $" class="p-3 rounded-xl ring-1 ring-purple-300 text-sm">
          </div>
          <button onclick="guardarPedido()" class="w-full py-3 rounded-xl bg-purple-600 text-white font-bold uppercase text-xs">Registrar Pedido</button>
        </div>
      </div>

      <div class="glass-card p-4 overflow-hidden">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-[10px] font-bold text-slate-500 uppercase italic">Historial</h3>
          <button onclick="exportarExcel()" class="bg-emerald-600 text-white px-3 py-1 rounded-lg text-[9px] font-bold">EXCEL</button>
        </div>
        <div class="overflow-x-auto max-h-[300px]">
          <table class="w-full text-left text-[11px]">
            <thead class="bg-slate-50 sticky top-0">
              <tr>
                <th class="p-3">Sku</th>
                <th class="p-3">Producto</th>
                <th class="p-3">Utilidad</th>
                <th class="p-3"></th>
              </tr>
            </thead>
            <tbody id="listaP" class="divide-y divide-slate-100"></tbody>
          </table>
        </div>
        <button onclick="borrarTodo()" class="w-full mt-4 text-[8px] text-slate-300 font-bold uppercase hover:text-red-500 transition">Reiniciar Base de Datos</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Configuraci칩n de Usuarios
  const users = { 'proveedor': 'garcia77', 'administrador': 'admin2026', 'encargado': 'ventas01' };
  
  // Base de Datos Local
  let DB = JSON.parse(localStorage.getItem('ag_v_final')) || { productos: [], rifas: [], pedidos: [] };
  let myChart;

  // Login
  function intentarLogin() {
    const u = document.getElementById('userInput').value.toLowerCase();
    const p = document.getElementById('passInput').value;
    if(users[u] && users[u] === p) {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('app').classList.remove('hidden');
      document.getElementById('roleTag').innerText = "SESI칍N: " + u;
      initScanner();
      actualizar();
    } else {
      document.getElementById('loginError').classList.remove('hidden');
    }
  }

  // Lector de Barras
  function initScanner() {
    const scanner = new Html5QrcodeScanner("reader", { fps: 15, qrbox: 250 });
    scanner.render((text) => {
      document.getElementById('pSku').value = text;
      document.getElementById('codeVal').innerText = text;
      document.getElementById('scanResult').classList.remove('hidden');
    });
  }

  // Cambio de Pesta침as
  function setTab(t) {
    document.getElementById('formP').classList.toggle('hidden', t!==1);
    document.getElementById('formR').classList.toggle('hidden', t!==2);
    document.getElementById('formPe').classList.toggle('hidden', t!==3);
    [1,2,3].forEach(i => {
      document.getElementById('tab'+i).className = i===t ? "tab-active pb-2 text-xs uppercase font-bold" : "text-slate-400 pb-2 text-xs uppercase font-bold";
    });
  }

  // L칩gica Principal
  function actualizar() {
    const lp = document.getElementById('listaP');
    lp.innerHTML = '';
    let vProd=0, uProdTotal=0, pPendiente=0, uRifasTotal=0;

    DB.productos.forEach((p, i) => {
      let u = p.tipo === 'salida' ? (p.pre - p.cos) : 0;
      if(p.tipo === 'salida') { vProd += p.pre; uProdTotal += u; }
      lp.innerHTML += `
        <tr>
          <td class="p-3 font-mono text-cyan-600">${p.sku || '---'}</td>
          <td class="p-3 font-bold text-slate-700 uppercase">${p.nom}</td>
          <td class="p-3 font-bold text-emerald-600">$${u.toFixed(2)}</td>
          <td class="p-3 text-right"><button onclick="borrarP(${i})" class="text-slate-300 hover:text-red-500"><i class="fas fa-trash"></i></button></td>
        </tr>`;
    });

    DB.rifas.forEach(r => uRifasTotal += (r.cant * 10) - r.costo);
    DB.pedidos.forEach(pe => pPendiente += (pe.total - pe.pagado));

    document.getElementById('resVentas').innerText = `$${vProd.toFixed(2)}`;
    document.getElementById('resRifas').innerText = `$${uRifasTotal.toFixed(2)}`;
    document.getElementById('resPedidos').innerText = `$${pPendiente.toFixed(2)}`;
    document.getElementById('resNeto').innerText = `$${(uProdTotal + uRifasTotal).toFixed(2)}`;

    localStorage.setItem('ag_v_final', JSON.stringify(DB));
    renderChart(uProdTotal, uRifasTotal);
  }

  function renderChart(up, ur) {
    const ctx = document.getElementById('chartGarcia').getContext('2d');
    if(myChart) myChart.destroy();
    myChart = new Chart(ctx, {
      type: 'doughnut',
      data: { labels: ['Ventas', 'Rifas'], datasets: [{ data: [up, ur], backgroundColor: ['#0ea5e9', '#f59e0b'], borderWidth: 0 }] },
      options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
    });
  }

  document.getElementById('formP').onsubmit = (e) => {
    e.preventDefault();
    DB.productos.push({
      sku: document.getElementById('pSku').value,
      tipo: document.getElementById('pTipo').value,
      nom: document.getElementById('pNom').value.toUpperCase(),
      cos: parseFloat(document.getElementById('pCos').value) || 0,
      pre: parseFloat(document.getElementById('pPre').value) || 0
    });
    actualizar(); e.target.reset();
  };

  function guardarRifa() {
    DB.rifas.push({ 
        nom: document.getElementById('rNom').value.toUpperCase(), 
        costo: parseFloat(document.getElementById('rCosto').value)||0, 
        cant: parseInt(document.getElementById('rCant').value)||0 
    });
    actualizar(); setTab(1);
  }

  function guardarPedido() {
    DB.pedidos.push({ 
        cliente: document.getElementById('peCli').value.toUpperCase(), 
        total: parseFloat(document.getElementById('peTot').value)||0, 
        pagado: parseFloat(document.getElementById('peAnt').value)||0 
    });
    actualizar(); setTab(1);
  }

  function borrarP(i) { DB.productos.splice(i, 1); actualizar(); }
  function borrarTodo() { if(confirm("쮹orrar todo?")) { DB={productos:[], rifas:[], pedidos:[]}; actualizar(); } }

  function exportarExcel() {
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(DB.productos), "Ventas");
    XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(DB.rifas), "Rifas");
    XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(DB.pedidos), "Pedidos");
    XLSX.writeFile(wb, "Reporte_Garcia_Pro.xlsx");
  }
</script>
</body>
</html>